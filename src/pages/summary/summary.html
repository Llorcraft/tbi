<ion-header>
  <ion-toolbar>
    <ion-title>Summary - {{project.name}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
<table class="data">
  <thead>
    <tr>
      <th colspan="2"></th>
      <th colspan="6" class="bg-green" style="border-bottom: 5px solid #fff;">Energy analysis</th>
      <th rowspan="2" class="bg-red">Safety</th>
      <th rowspan="2" class="bg-blue">Maintenance</th>
      <th rowspan="2" class="bg-gray">Others</th>
      <th class="bg-blue-light">Tbi</th>
      <th class="bg-green-light" colspan="4">Input</th>
      <th colspan="2" rowspan="3">Actions</th>
    </tr>
    <tr>
      <th colspan="2" style="border-right: 1px solid #444">Component / Location</th>
      <th colspan="2" style="border-top: 1px solid #444; border-right: 1px solid #444">Energy Loss<br>per year</th>
      <th colspan="4" style="border-top: 1px solid #444; border-right: 1px solid #444">Potential Savings<br>per year</th>
      <th>Insulation Advise</th>
      <th class="vertical"><div><span one-line>Insulated</span></div></th>
      <th class="vertical"><div><span one-line>Surface temp</span></div></th>
      <th class="vertical"><div><span one-line>Dimension</span></div></th>
      <th class="vertical"><div><span one-line>Items number</span></div></th>
    </tr>
  </thead>
  <tbody *ngFor="let c of components; let i=index">
    <tr [class.disabled]="c.fields.unknow_surface">
      <td rowspan="2" double-border text-center>{{i+1}}</td>
      <td rowspan="2" double-border class="b-right">{{c.fields.location}}</td>
      
      <ng-container *ngIf="!!c.result">
        <td text-center class="bg-light-red c-red">{{c.result.headLost.power | number: '1.0-0'}}</td>
        <td class="bg-light-red c-red b-right">kWh<span *ngIf="c.fields.unknow_surface">/m<sup>2</sup></span></td>
        <td text-right class="bg-green c-gree">{{c.result.savingPotentialMin?.power | number: '1.0-0'}}</td>
        <td text-center class="bg-green c-gree"><ion-icon name="md-arrow-forward"></ion-icon></td>
        <td text-right class="bg-green c-gree">{{c.result.savingPotentialMax?.power | number: '1.0-0'}}</td>
        <td class="bg-green c-gree mesure b-right">kWh<span *ngIf="c.fields.unknow_surface">/m<sup>2</sup></span></td>
      </ng-container>
      <ng-container *ngIf="!c.result">
          <td colspan="2" class="b-right"></td>
          <td colspan="4" class="b-right"></td>
      </ng-container>

      <td rowspan="2" double-border text-center class="bg-red">
        <a href="#" (click)="open(r)" *ngFor="let r of c.reports_by_type('safety')">{{r.summary_id}}</a>
      </td>
      <td rowspan="2" double-border text-center class="bg-blue">
        <a href="#" (click)="open(r)" *ngFor="let r of c.reports_by_type('mantenance|condensation|damaged')">{{r.summary_id}}</a>
      </td>
      <td rowspan="2" double-border text-center class="bg-gray">
        <a href="#" (click)="open(r)" *ngFor="let r of c.reports_by_type('generic|custom')">{{r.summary_id}}</a>
      </td>
      <td rowspan="2" *ngIf="!!c.result" double-border text-center>{{advises.get(c.result.advise)}}</td>
      <td rowspan="2" *ngIf="!c.result" double-border text-center></td>
      <td rowspan="2" double-border text-center>{{!!c.insulated ? 'Y' : 'N'}}</td>
      <td *ngIf="null!=c.fields.surface_temp" rowspan="2" double-border text-center>{{c.fields.surface_temp}}&deg;C</td>
      <td *ngIf="null==c.fields.surface_temp" rowspan="2" double-border text-center>&nbsp;</td>
      <td rowspan="2" double-border text-center>
        <span *ngIf="!!c.surface">{{c.fields.surface}} m<sup>2</sup></span>
        <span>{{c.fields.main_dimension}}</span>
      </td>
      <td rowspan="2" double-border text-center>{{c.fields.number}}</td>
      <td text-center double-border rowspan="2"><ion-icon (click)="edit(c)" name="md-create"></ion-icon></td>
      <td text-center double-border rowspan="2"><ion-icon (click)="remove(c)" name="md-trash"></ion-icon></td>
    </tr>

    <tr *ngIf="!!c.result" [class.disabled]="c.fields.unknow_surface">
      <td double-border text-right class="c-red">{{c.result.headLost?.money | number: '1.0-0'}}</td>
      <td double-border class="c-red mesure b-right">€<span *ngIf="c.fields.unknow_surface">/m<sup>2</sup></span></td>
      <td double-border text-right class="c-gree">{{c.result.savingPotentialMin?.money | number: '1.0-0'}}</td>
      <td double-border text-center class="c-gree"><ion-icon name="md-arrow-forward"></ion-icon></td>
      <td double-border text-right class="c-gree">{{c.result.savingPotentialMax?.money | number: '1.0-0'}}</td>
      <td double-border class="c-gree mesure b-right">€<span *ngIf="c.fields.unknow_surface">/m<sup>2</sup></span></td>
    </tr>
    <tr *ngIf="!c.result" [class.disabled]="c.fields.unknow_surface">
        <td double-border colspan="2" class="b-right"></td>
        <td double-border colspan="4" class="b-right"></td>
      </tr>
  </tbody>
</table>
<ion-grid *ngIf="!!totals">
  <ion-row>
    <ion-col col-10 offset-1 text-center>
      <table class="total red">
        <tr>
          <td>Energy loss per year</td>
          <td text-right>{{totals.headLost.power | number: '1.0-0'}}</td>
          <td>kWh</td>
        </tr>
        <tr>
          <td>Money loss per year</td>
          <td text-right>{{totals.headLost.money | number: '1.0-0'}}</td>
          <td>€</td>
        </tr>
      </table>

      <table class="total green">
          <tr>
            <td>Potential energy saving per year</td>
            <td text-right>{{totals.savingPotentialMin.power | number: '1.0-0'}}</td>
            <td text-center><ion-icon name="md-arrow-forward"></ion-icon></td>
            <td text-right>{{totals.savingPotentialMax.power | number: '1.0-0'}}</td>
            <td>kWh</td>
          </tr>
          <tr>
            <td>Potential money saving per year</td>
            <td text-right>{{totals.savingPotentialMin.money | number: '1.0-0'}}</td>
            <td text-center><ion-icon name="md-arrow-forward"></ion-icon></td>
            <td text-right>{{totals.savingPotentialMax.money | number: '1.0-0'}}</td>
            <td>€</td>
          </tr>
        </table>  
    </ion-col>
  </ion-row>
</ion-grid>
</ion-content>

<ion-footer>
  <ion-grid no-padding>
    <ion-row no-padding>
      <ion-col col-6 no-padding>
        <button ion-button small color="light" (click)="navCtrl.pop()">
          <ion-icon name="arrow-back"></ion-icon>&nbsp;Back
        </button>
      </ion-col>
      <ion-col col-6 text-right>
          <button tabindex="15" ion-button small color="primary" (click)="go_to_reports()">
              New component
          </button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-footer>
